# Дашборды главной страницы (route "/") для Ментора и Менти

## Цель документа

Спроектировать дашборды для главной страницы приложения по маршруту `/` для ролей **Ментор** и **Менти**: сценарии, метрики, источники данных, UX-логика, API-контракт и ограничения.

**Контекст:** заявки со статусами На рассмотрении (SENT), Подтверждена (ACCEPTED), Отклонена (REJECTED), Завершено (COMPLETED). После подтверждения — активная связь (Connection ACTIVE). Связь может быть завершена (completedAt) или разорвана (DETACHED). См. [11-mentorship-completion.md](11-mentorship-completion.md).

---

## 1. Сценарии пользователей

### 1.1. Ключевые вопросы дашборда

**Ментор при открытии главной страницы должен сразу понять:**

- Есть ли заявки, которые ждут моего решения (принять/отклонить).
- Сколько у меня активных менти (связи в работе, курс ещё не завершён).
- Сколько менторств я успешно завершил (ощущение прогресса и пользы).
- Есть ли связи, которые уже завершены, но ещё не отвязаны (можно отвязаться для порядка).

**Менти при открытии главной страницы должен сразу понять:**

- Есть ли мои заявки, которые ещё рассматривают (ожидание ответа).
- Сколько у меня активных связей с менторами (текущие курсы).
- Сколько курсов я успешно завершил (прогресс, завершённость).
- Есть ли отклонённые заявки и что делать дальше (например, выбрать другого ментора).

### 1.2. Отличия дашбордов по ролям

| Аспект | Ментор | Менти |
|--------|--------|--------|
| Заявки «требуют действия» | Входящие со статусом SENT (принять/отклонить) | Нет прямого действия; показываем «на рассмотрении» (ожидание) |
| Заявки «мои» | Входящие (все статусы) | Исходящие (все статусы) |
| Связи | Я — ментор (менти в каждой связи) | Я — менти (ментор в каждой связи) |
| Приоритет «сверху» | Входящие заявки на рассмотрении → активные связи → завершённые | Заявки на рассмотрении → активные связи → завершённые курсы |
| Действия с дашборда | Перейти к заявке (принять/отклонить), завершить менторство, отвязаться | Перейти к заявке (просмотр), завершить менторство, отвязаться, «Найти ментора» |

---

## 2. Набор метрик и виджетов

### 2.1. Дашборд ментора

**Обязательные показатели (первая итерация):**

| Метрика | Описание | Источник |
|---------|----------|----------|
| Заявки на рассмотрении | Количество входящих заявок со статусом SENT | Request, mentorId = я, status = SENT |
| Активные менти | Количество связей: status = ACTIVE и completedAt = null | Connection, mentorId = я |
| Завершённые менторства | Количество связей с completedAt ≠ null | Connection, mentorId = я, completedAt IS NOT NULL |

**Виджеты (блоки):**

1. **«Требуют вашего решения»** — список заявок SENT (входящие). Карточка: имя менти, превью письма, дата, кнопки «Принять» / «Отклонить» или ссылка «Перейти к заявке».
2. **«Активные менти»** — список связей ACTIVE без completedAt. Карточка: имя менти, дата начала, кнопки «Завершить менторство» / «Отвязаться» или ссылка в раздел связей.
3. **«Завершённые менторства»** — список связей с completedAt (последние N). Карточка: имя менти, дата завершения; при status = ACTIVE — кнопка «Отвязаться».

**Вторичные показатели (первая итерация — числа или краткий список, без сложной аналитики):**

| Метрика | Описание | Когда показывать |
|---------|----------|-------------------|
| Отклонённые заявки (число или «последние») | Входящие со статусом REJECTED | По желанию продукта — блок «История заявок» или только число. |
| Заявки подтверждённые, но без активной связи | Edge-case (если связь удалена) | Обычно не показывать на дашборде. |

**Метрики возможные в будущем (не в первой итерации):**

- Средняя длительность менторства (completedAt − createdAt по связям).
- График «завершённых по месяцам».
- Рейтинги, отзывы.

### 2.2. Дашборд менти

**Обязательные показатели:**

| Метрика | Описание | Источник |
|---------|----------|----------|
| Заявки на рассмотрении | Исходящие заявки со статусом SENT (ожидание ответа ментора) | Request, menteeId = я, status = SENT |
| Активные связи | Связи: status = ACTIVE и completedAt = null | Connection, menteeId = я |
| Завершённые курсы | Связи с completedAt ≠ null | Connection, menteeId = я, completedAt IS NOT NULL |

**Виджеты (блоки):**

1. **«Ожидают ответа»** — исходящие заявки SENT. Карточка: имя ментора, превью, дата, ссылка «Подробнее».
2. **«Активные связи»** — связи ACTIVE без completedAt. Карточка: имя ментора, дата начала, «Завершить менторство» / «Отвязаться» или ссылка.
3. **«Завершённые курсы»** — связи с completedAt (последние N). Карточка: имя ментора, дата завершения; при необходимости «Отвязаться».

**Вторичные показатели:**

| Метрика | Описание |
|---------|----------|
| Отклонённые заявки | Исходящие REJECTED — число или краткий список, призыв «Выбрать другого ментора». |

**Будущее:** средняя длительность курса, графики, рейтинги.

### 2.3. Таблица метрик с формулами расчёта

| Метрика | Роль | Формула / условие | Сущность, поля |
|---------|------|-------------------|----------------|
| Заявки на рассмотрении | Ментор | count(Request) where mentorId = myMentorId AND status = 'SENT' | Request |
| Заявки на рассмотрении | Менти | count(Request) where menteeId = myMenteeId AND status = 'SENT' | Request |
| Активные связи | Ментор | count(Connection) where mentorId = myMentorId AND status = 'ACTIVE' AND completedAt IS NULL | Connection |
| Активные связи | Менти | count(Connection) where menteeId = myMenteeId AND status = 'ACTIVE' AND completedAt IS NULL | Connection |
| Завершённые менторства/курсы | Обе | count(Connection) where (mentorId = myMentorId OR menteeId = myMenteeId) AND completedAt IS NOT NULL | Connection |
| Список «требуют решения» | Ментор | Request where mentorId = myMentorId, status = 'SENT', order by createdAt desc, limit 10 | Request + Mentee + Profile |
| Список «ожидают ответа» | Менти | Request where menteeId = myMenteeId, status = 'SENT', order by createdAt desc, limit 10 | Request + Mentor + Profile |
| Список активных связей | Обе | Connection where (mentorId/menteeId), status = 'ACTIVE', completedAt IS NULL, order by createdAt desc | Connection + другая сторона + Profile |
| Список завершённых | Обе | Connection where completedAt IS NOT NULL, order by completedAt desc, limit 5–10 | Connection + другая сторона + Profile |

**Определения:**

- **Активная связь (для счётчика и списка «активные»):** `Connection.status = 'ACTIVE'` и `Connection.completedAt IS NULL`. Связь «в работе», курс не отмечен завершённым.
- **Завершённое менторство/курс:** `Connection.completedAt IS NOT NULL`. Не зависит от status (после отвязки status = DETACHED, но completedAt сохраняется).
- **Заявка на рассмотрении:** `Request.status = 'SENT'`.

---

## 3. Источники данных и логика расчёта

### 3.1. Сущности и поля

- **Request:** id, menteeId, mentorId, message, status, createdAt, updatedAt. Связь с Connection (для completedAt при отображении заявки).
- **Connection:** id, mentorId, menteeId, requestId, status, createdAt, completedAt, detachedAt, reason. Связи Mentor, Mentee, Request.
- **Profile:** firstName, lastName (и при необходимости specialty, avatarUrl) для отображения имён в карточках.
- Роль текущего пользователя: через Profile → Mentor.id или Mentee.id (в MVP одна роль).

### 3.2. Бизнес-правила

- **Ментор:** все выборки по заявкам — по `request.mentorId = currentUser.mentorId`; по связям — по `connection.mentorId = currentUser.mentorId`.
- **Менти:** заявки — по `request.menteeId = currentUser.menteeId`; связи — по `connection.menteeId = currentUser.menteeId`.
- Лимиты списков на дашборде: заявки «на рассмотрении» / «ожидают ответа» — до 10; активные связи — до 10; завершённые — до 5–10 (настраиваемо).
- Контактные данные (email) в карточке связи показывать только для активной связи (status = ACTIVE), как в текущем API connections.

---

## 4. UX-логика

### 4.1. Приоритет отображения блоков (сверху вниз)

**Ментор:**

1. **Требуют вашего решения** — входящие заявки SENT. Если пусто — блок можно не показывать или показать с текстом «Нет новых заявок».
2. **Активные менти** — активные связи (ACTIVE, completedAt null). Если пусто — «Нет активных менти» + призыв в каталог не нужен (каталог для менти).
3. **Завершённые менторства** — связи с completedAt. Опционально ниже — краткая история или счётчики.

**Менти:**

1. **Ожидают ответа** — исходящие SENT. Если пусто — «Нет заявок на рассмотрении».
2. **Активные связи** — активные связи с менторами.
3. **Завершённые курсы** — связи с completedAt. Ниже — призыв «Найти ментора» или «В каталог», если нет активных.

### 4.2. Пустые состояния (новый пользователь)

- **Ментор:** нет входящих заявок, нет связей. Текст: «Пока нет заявок. Когда менти будут отправлять заявки, они появятся здесь» и/или напоминание заполнить профиль ментора (принимает заявки, темы и т.д.).
- **Менти:** нет исходящих заявок, нет связей. Текст: «Начните с поиска ментора» + кнопка «Каталог менторов» / «Найти ментора».

При частично заполненном дашборде (например, есть только завершённые): показывать блоки с нулями или «Нет активных», чтобы структура была предсказуемой.

### 4.3. Действия с дашборда

| Действие | Где | Роль | Реализация |
|----------|-----|------|------------|
| Перейти к заявке | Карточка заявки | Обе | Ссылка на `/requests/:id` или модалка; ментор — принять/отклонить, менти — просмотр. |
| Принять / Отклонить заявку | Карточка входящей заявки | Ментор | Кнопки → PATCH requests/:id/accept, reject. |
| Завершить менторство | Карточка активной связи | Обе | Кнопка → POST/PATCH connections/:id/complete. |
| Отвязаться | Карточка связи (ACTIVE или завершённая, но ACTIVE) | Обе | Кнопка → форма причина → POST connections/:id/detach. |
| Найти ментора / В каталог | Пустое состояние или отдельная кнопка | Менти | Ссылка на `/mentors` или поиск. |

Не обязательно дублировать все действия на главной: достаточно коротких карточек со ссылкой «Подробнее» / «К заявке» / «К связям», а принять/отклонить/завершить/отвязаться — на странице заявки или связей.

---

## 5. API / контракт

### 5.1. Один запрос для дашборда

**Вариант (рекомендуемый):** единый endpoint, возвращающий всё необходимое для главной страницы в зависимости от роли.

**Endpoint:** `GET /api/dashboard` (или `GET /api/me/dashboard`).

**Ответ:** один JSON-объект с полями:

- **role:** `'MENTOR' | 'MENTEE'` — текущая роль (из профиля).
- **summary:** счётчики для заголовков/карточек.
- **widgets:** данные для блоков (списки заявок и связей в сокращённом виде).

Пример структуры ответа (расширяемая):

```json
{
  "role": "MENTOR",
  "summary": {
    "pendingRequestsCount": 2,
    "activeConnectionsCount": 1,
    "completedMentorshipsCount": 5
  },
  "widgets": {
    "pendingRequests": [
      {
        "id": "req-uuid",
        "status": "SENT",
        "createdAt": "2025-02-01T10:00:00Z",
        "messagePreview": "Хочу разобраться в...",
        "mentee": {
          "id": "mentee-uuid",
          "firstName": "Иван",
          "lastName": "Иванов",
          "goal": "Рост до middle"
        }
      }
    ],
    "activeConnections": [
      {
        "id": "conn-uuid",
        "requestId": "req-uuid",
        "status": "ACTIVE",
        "createdAt": "2025-01-15T12:00:00Z",
        "completedAt": null,
        "otherParty": {
          "firstName": "Пётр",
          "lastName": "Петров"
        }
      }
    ],
    "completedMentorships": [
      {
        "id": "conn-uuid-2",
        "status": "DETACHED",
        "completedAt": "2025-01-20T14:00:00Z",
        "otherParty": { "firstName": "Анна", "lastName": "Сидорова" }
      }
    ]
  }
}
```

Для **менти** те же блоки с другой семантикой: `pendingRequests` — «ожидают ответа» (исходящие SENT), `activeConnections` — активные связи, `completedMentorships` — завершённые курсы. Поле `otherParty` для менти — данные ментора.

### 5.2. Именование полей и расширение

- Все счётчики в `summary` — суффикс `Count`, чтобы при добавлении новых метрик не путать с массивами.
- Списки в `widgets` — те же сущности, что и в существующих API (request, connection), но с подмножеством полей, достаточным для карточки на дашборде. Полные данные — по ссылкам на `/requests/:id`, `/connections` и т.д.
- Расширение: добавлять новые ключи в `summary` и `widgets` без удаления старых (обратная совместимость). Фронт может игнорировать неизвестные ключи.

### 5.3. Альтернатива: без единого endpoint

Использовать существующие:

- `GET /api/requests/incoming` (ментор) или `GET /api/requests/outgoing` (менти),
- `GET /api/connections`,

и на фронте считать счётчики и слайсы. Минус: два запроса, лишние данные при большом количестве. Для первой итерации допустимо; при росте числа заявок/связей предпочтительнее `GET /api/dashboard`.

---

## 6. Ограничения и допущения

### 6.1. Не входит в первую итерацию

- Графики и тренды (завершённые по месяцам, длительность).
- Рейтинги, отзывы, рекомендации.
- Сложная аналитика (среднее время до ответа, конверсия заявок в связи).
- Экспорт отчётов.
- Кастомизация виджетов (порядок, скрытие блоков).

### 6.2. Допустимые заглушки на старте

- Если блок «Завершённые» пуст — показывать «Пока нет завершённых менторств» без скрытия блока (привыкание к структуре).
- Даты — в формате ISO 8601; форматирование (например, «3 февраля 2025») на фронте.
- Аватарки в карточках: при отсутствии — инициалы (как в профиле по проекту).

### 6.3. Зависимость от роли

- Дашборд доступен только авторизованному пользователю с выбранной ролью (Ментор или Менти). Если роль не выбрана — редирект на выбор роли или онбординг (по текущим сценариям приложения).

---

## 7. Рекомендации для дизайна и разработки

1. **Единая структура для обеих ролей:** три блока — «требуют внимания / ожидают», «активные связи», «завершённые». Тексты и заголовки меняются по роли (например, «Требуют вашего решения» vs «Ожидают ответа»).
2. **Счётчики в заголовках блоков:** например, «Заявки на рассмотрении (2)», «Активные менти (1)», «Завершённые менторства (5)» — сразу видно объём.
3. **Карточки компактные:** имя, дата, превью/цель, одна основная кнопка (или ссылка). Детали — на отдельной странице.
4. **Пустые состояния:** короткий текст + одно основное действие (каталог для менти, ожидание заявок для ментора).
5. **Мобильная версия:** те же блоки, вертикальный скролл; кнопки «Принять»/«Отклонить» и «Завершить» остаются доступны (не только «Подробнее»).
6. **Backend:** реализовать `GET /api/dashboard` через общий сервис (например, `DashboardService`), который по роли пользователя вызывает логику для ментора или менти и собирает summary + widgets из Request и Connection с нужными include. Не дублировать полную бизнес-логику заявок/связей — переиспользовать существующие сервисы и типы ответов там, где достаточно.

---

## 8. Итоговая сводка

| Раздел | Содержание |
|--------|-------------|
| Сценарии | Ментор: заявки на решение, активные менти, завершённые. Менти: заявки на рассмотрении, активные связи, завершённые курсы. |
| Метрики | Счётчики и списки по Request (SENT) и Connection (ACTIVE без completedAt, завершённые по completedAt). Формулы в п. 2.3. |
| API | `GET /api/dashboard` → role, summary (Counts), widgets (pendingRequests, activeConnections, completedMentorships). Расширяемо новыми ключами. |
| UX | Порядок: требуют внимания → активные → завершённые. Пустые состояния с одним призывом к действию. Действия с карточек или со страниц заявок/связей. |
| Ограничения | Без графиков, рейтингов, сложной аналитики в первой итерации. Заглушки для пустых блоков допустимы. |

Документ готов к использованию дизайном и разработкой для реализации дашбордов на маршруте `/`.
