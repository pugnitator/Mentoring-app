# Этап 2 — User Profile & Role Selection (UC-03, UC-04)

## 1. Цель и контекст

**Цель этапа:**
Пользователь после регистрации/входа может выбрать платформенную роль (ментор или менти) и заполнить личный профиль (общие поля + поля, зависящие от роли).

**Связь с документами:**

* `progect.md`:

  * UC-03 — выбор роли
  * UC-04 — управление профилем
  * п.4 — роли
  * п.5 — поля профиля
* `plans/major.md`:

  * этап 2

    * backend: схема БД, модули `profiles / mentors / mentees`, endpoint выбора роли, загрузка фото
    * frontend: страница выбора роли, `/profile`, формы, аватар

**Ограничение MVP:**
У пользователя может быть **только одна активная платформенная роль** (либо ментор, либо менти).

**Текущее состояние (после этапа 1):**

* В БД есть только модель `User`:

  * `id`
  * `email`
  * `passwordHash`
  * `role: USER | ADMIN` (системная роль)
  * `status`
  * `createdAt`
  * `updatedAt`
* Платформенная роль (ментор/менти) **не реализована**
* После логина/регистрации фронт сохраняет JWT и редиректит на `/`
* Нет состояния:

  * выбрана ли платформенная роль
  * заполнен ли профиль

---

## 2. Сценарии использования

### UC-03. Выбор роли

#### Первый выбор роли после регистрации

**Предусловие:**
Пользователь только что зарегистрировался, профиля и роли нет

**Действия:**
Открывает приложение → выбирает «Ментор» или «Менти» → подтверждает

**Ожидаемый результат:**
Создаётся `Profile` и запись `Mentor` или `Mentee`, пользователь переходит к заполнению профиля

---

#### Первый выбор роли после логина

**Предусловие:**
Пользователь залогинен, профиля/роли нет

**Действия:**
Заходит на `/profile` или специальный маршрут выбора роли → выбирает роль

**Ожидаемый результат:**
Аналогично первому сценарию

---

#### Роль уже выбрана

**Предусловие:**
У пользователя уже есть `Profile` и `Mentor` или `Mentee`

**Действия:**
Заходит на страницу выбора роли

**Ожидаемый результат:**
Показать текущую роль и переход в профиль
Смена роли в MVP **недоступна**

**Правило:**
В MVP роль выбирается **один раз** и не меняется.

---

### UC-04. Управление профилем

#### Заполнение общих полей

**Действия:**
Пользователь вводит ФИО, специальность, уровень, био, город, загружает фото

**Результат:**
Данные сохраняются в `Profile`, проходит валидация обязательных полей

---

#### Редактирование общих полей

**Действия:**
Изменение данных → «Сохранить»

**Результат:**
Обновление `Profile`

---

#### Профиль ментора

**Действия:**
Заполнение:

* темы специализации
* описание услуг
* формат работы
* принимает заявки (да/нет)
* комментарий к статусу
* макс. кол-во активных менти

**Результат:**
Данные сохраняются в `Mentor`

---

#### Профиль менти

**Действия:**
Заполнение:

* цель / проблема
* желаемая должность
* статус поиска

**Результат:**
Данные сохраняются в `Mentee`

---

#### Отображение аватара

* Если есть `avatarUrl` — показывать изображение
* Иначе — круг с первой буквой имени

---

### Обязательность полей

**Общие поля:**

* фамилия — обязательно
* имя — обязательно
* отчество — необязательно
* текущая специальность — обязательно
* уровень — необязательно
* био — необязательно
* город — необязательно
* фото — необязательно

#### Список IT-специальностей (MVP)

Пользователь выбирает **одну специальность** из списка.  
Свободный ввод недоступен.  
Поиск работает по русскому и английскому названию.

---

1. Frontend-разработчик  
2. Backend-разработчик  
3. Fullstack-разработчик  
4. Java-разработчик  
5. Python-разработчик  
6. Mobile-разработчик (iOS / Android)  
7. QA Engineer (Manual / Automation)  
8. Системный аналитик (SA)  
9. Бизнес-аналитик (BA)  
10. Product Manager (PM)  
11. Data Analyst  
12. Data Scientist  
13. DevOps-инженер  
14. UI/UX Designer  
15. Архитектор (Software Architect)

---

##### Примечания

- Основное название — на русском, английское используется как алиас для поиска.
- Названия языков и общепринятые сокращения сохраняются.
- В MVP **одна активная специальность на пользователя**.
- Список может быть расширен на следующих этапах.


**Ментор:**

* темы специализации — обязательно
* описание услуг — обязательно
* формат работы — обязательно
* принимает заявки — обязательно
* комментарий — обязательно, если `acceptsRequests = false`
* макс. кол-во менти — обязательно

**Менти:**

* цель / проблема — обязательно
* желаемая должность — необязательно
* статус поиска — обязательно

---

## 3. Backend

### 3.1 Prisma-схема

**Сохранить:**
`User` без удаления существующих полей.

**Добавить:**

#### Profile (1:1 с User)

* `id`
* `userId` (unique)
* `firstName`
* `lastName`
* `middleName?`
* `specialty`
* `level?` (`JUNIOR | MIDDLE | SENIOR | LEAD`)
* `bio?`
* `city?`
* `avatarUrl?`
* `createdAt`
* `updatedAt`

#### Mentor (1:1 с Profile)

* `profileId` (unique)
* `description`
* `workFormat`
* `acceptsRequests`
* `statusComment?`
* `maxMentees`
* `specializationTopics: String[]`
* `createdAt`
* `updatedAt`

> Темы специализации временно хранятся как массив строк. Таблицы `Tag` и `MentorTag` — этап 3.

#### Mentee (1:1 с Profile)

* `profileId` (unique)
* `goal`
* `desiredPosition?`
* `searchStatus: SEARCHING | NOT_SEARCHING`
* `createdAt`
* `updatedAt`

**Ограничение:**
У одного `Profile` может быть **либо Mentor, либо Mentee**.

---

### 3.2 Загрузка фото профиля

**Варианты:**

* **A. Локальное хранение файлов**

  * хранить URL в `avatarUrl`
  * multipart/form-data
* **B. Base64**

  * хранить base64 в `avatarUrl`
  * лимит размера (например, 500 KB)
  * проверка MIME

> Для MVP выбрать **один** вариант и зафиксировать в README.

---

### 3.3 Endpoints

#### Profile

* `GET /api/profiles/me`
* `PUT /api/profiles/me`

#### Выбор роли

* `POST /api/profiles/me/role`

  ```json
  { "role": "MENTOR" | "MENTEE" }
  ```

  * 409, если роль уже выбрана

#### Mentor

* `GET /api/mentors/me`
* `PUT /api/mentors/me`

#### Mentee

* `GET /api/mentees/me`
* `PUT /api/mentees/me`

#### Avatar

* `POST /api/profiles/me/avatar`

---

### 3.4 Валидация и ошибки

* `class-validator`
* сообщения на русском
* единый формат ошибок
* 409 Conflict при повторном выборе роли

---

## 4. Frontend

### 4.1 Состояние «роль не выбрана»

* `GET /api/profiles/me`
* если роли нет → редирект на `/onboarding`

---

### 4.2 Маршруты

* `/onboarding` — выбор роли
* `/profile` — личный кабинет

---

### 4.3 Страницы

* выбор роли (MENTOR / MENTEE)
* профиль:

  * общие поля
  * блок ментора или менти
  * аватар или инициалы

---

### 4.4 API и состояние

* React Query
* invalidate профиля после мутаций
* типы TS для Profile / Mentor / Mentee

---

## 5. Граничные случаи

| Ситуация                                    | Ожидаемое поведение       |
| ------------------------------------------- | ------------------------- |
| Нет профиля → `/profile`                    | редирект на `/onboarding` |
| Есть роль → `/onboarding`                   | редирект на `/profile`    |
| Повторный выбор роли                        | 409 Conflict              |
| Нет комментария при `acceptsRequests=false` | 400                       |
| Аватар вне лимита                           | 400                       |
| Без JWT                                     | 401                       |

---

## 6. Контракты API (примеры)

Примеры запросов и ответов — согласно Prisma-моделям и DTO.

---

## 7. Чек-лист

* Prisma: Profile, Mentor, Mentee
* Backend: endpoints `me`, `role`, `avatar`
* Одна роль на пользователя
* Frontend: `/onboarding`, `/profile`
* Аватар или инициалы
* Все тексты на русском

---

**Результат этапа:**
Пользователь может выбрать роль и полностью заполнить профиль.
Если фото нет — отображаются инициалы.
